# Step1 DeFi System é¡¹ç›®æ–‡æ¡£æŒ‡å—

## é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªåŸºäºMassaåŒºå—é“¾çš„è‡ªä¸»DeFiäº¤æ˜“ç³»ç»Ÿï¼Œä½¿ç”¨ASCï¼ˆAutonomous Smart Contractsï¼‰æŠ€æœ¯å®ç°å®Œå…¨è‡ªä¸»çš„äº¤æ˜“å†³ç­–å’Œæ‰§è¡Œã€‚

## æ–‡ä»¶ç³»ç»Ÿç»“æ„è¯¦è§£

### æ ¹ç›®å½•æ–‡ä»¶
- `package.json` - é¡¹ç›®ä¾èµ–å’Œè„šæœ¬é…ç½®
- `tsconfig.json` - TypeScriptç¼–è¯‘é…ç½®
- `asconfig.json` - AssemblyScriptç¼–è¯‘é…ç½®
- `README.md` - é¡¹ç›®è‹±æ–‡è¯´æ˜æ–‡æ¡£
- `addresses.json` - å·²éƒ¨ç½²åˆçº¦åœ°å€è®°å½•
- `wallet_xihaopark.yaml` - é’±åŒ…é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«ç§é’¥ï¼Œè¯·å‹¿æäº¤åˆ°Gitï¼‰
- `.gitignore` - Gitå¿½ç•¥æ–‡ä»¶é…ç½®

### ğŸ“ assembly/ - æ™ºèƒ½åˆçº¦ç›®å½•

#### ğŸ“ assembly/contracts/
æ™ºèƒ½åˆçº¦çš„æ ¸å¿ƒå®ç°ï¼Œä½¿ç”¨AssemblyScriptç¼–å†™ã€‚

##### æ ¸å¿ƒæ–‡ä»¶ï¼š
- `main.ts` - **ä¸»å…¥å£åˆçº¦**
  - éƒ¨ç½²æ—¶çš„å…¥å£ç‚¹
  - å¯¼å‡ºæ‰€æœ‰åŠŸèƒ½å‡½æ•°
  - åŒ…å«ASCåˆå§‹åŒ–å‡½æ•°

- `types.ts` - **æ•°æ®ç±»å‹å®šä¹‰**
  - å®šä¹‰æ‰€æœ‰å…±äº«çš„æ•°æ®ç»“æ„
  - åŒ…æ‹¬ThreadStateã€MarketStateã€DecisionRecordç­‰

##### ğŸ“ core/ - æ ¸å¿ƒæ§åˆ¶é€»è¾‘
- `SimpleEnhancedController.ts` - **ä¸»æ§åˆ¶å™¨**
  - ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
  - åè°ƒå„ä¸ªæ¨¡å—çš„è¿è¡Œ
  - å¤„ç†è‡ªä¸»å¾ªç¯æ‰§è¡Œ
  
- `StateManager.ts` - **çŠ¶æ€ç®¡ç†å™¨**
  - ç®¡ç†ç³»ç»ŸçŠ¶æ€
  - çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€æ›´æ–°
  - çŠ¶æ€æŒä¹…åŒ–

##### ğŸ“ algorithms/ - ç®—æ³•æ¨¡å—
- `PracticalMarketDetector.ts` - **å¸‚åœºæ£€æµ‹ç®—æ³•**
  - å®ç”¨çš„å¸‚åœºçŠ¶æ€æ£€æµ‹
  - æ³¨æ„åŠ›æƒé‡è®¡ç®—
  - äº¤æ˜“ä¿¡å·ç”Ÿæˆ

##### ğŸ“ trading/ - äº¤æ˜“æ¨¡å—
- `TradingExecutor.ts` - **äº¤æ˜“æ‰§è¡Œå™¨**
  - é£é™©ç®¡ç†
  - ä»“ä½è®¡ç®—
  - äº¤æ˜“æ‰§è¡Œé€»è¾‘

##### ğŸ“ autonomous/ - è‡ªä¸»æ‰§è¡Œæ¨¡å—
- `AutonomousScheduler.ts` - **ASCè°ƒåº¦å™¨**
  - è‡ªä¸»æ‰§è¡Œçš„æ ¸å¿ƒå®ç°
  - è°ƒåº¦ä¸‹ä¸€æ¬¡æ‰§è¡Œ
  - ç´§æ€¥åœæ­¢å’Œæ¢å¤åŠŸèƒ½

##### ğŸ“ data/ - æ•°æ®å¤„ç†æ¨¡å—
- `DataAggregator.ts` - **æ•°æ®èšåˆå™¨**
  - å¤šæ•°æ®æºèšåˆ
  - å¼‚å¸¸å€¼æ£€æµ‹
  - æ€§èƒ½ä¼˜åŒ–

##### ğŸ“ oracles/ - é¢„è¨€æœºæ¨¡å—
- `PriceOracle.ts` - **ä»·æ ¼é¢„è¨€æœº**
  - è·å–å¤–éƒ¨ä»·æ ¼æ•°æ®
  - æ•°æ®éªŒè¯å’Œæ¸…æ´—
  - å¤šæºæ•°æ®èåˆ

##### ğŸ“ utils/ - å·¥å…·ç±»
- `Result.ts` - ç»“æœåŒ…è£…ç±»ï¼Œç”¨äºé”™è¯¯å¤„ç†

##### å…¶ä»–æ–‡ä»¶ï¼ˆå·²æ¸…ç†ï¼‰ï¼š
- `MainController.ts` - æ—§ç‰ˆä¸»æ§åˆ¶å™¨ï¼ˆå¯è€ƒè™‘åˆ é™¤ï¼‰
- `ObservationThread.ts` - è§‚å¯Ÿçº¿ç¨‹ï¼ˆå¯èƒ½æœªä½¿ç”¨ï¼‰

### ğŸ“ frontend/ - Reactå‰ç«¯åº”ç”¨

#### ä¸»è¦æ–‡ä»¶ï¼š
- `index.html` - HTMLå…¥å£æ–‡ä»¶
- `package.json` - å‰ç«¯ä¾èµ–é…ç½®
- `vite.config.ts` - Viteæ„å»ºé…ç½®
- `tsconfig.json` - TypeScripté…ç½®

#### ğŸ“ src/ - æºä»£ç 
- `main.tsx` - Reactåº”ç”¨å…¥å£
- `App.tsx` - ä¸»åº”ç”¨ç»„ä»¶
- `index.css` - å…¨å±€æ ·å¼
- `types.ts` - TypeScriptç±»å‹å®šä¹‰

##### ğŸ“ components/ - Reactç»„ä»¶
- `SystemStatus.tsx` - ç³»ç»ŸçŠ¶æ€æ˜¾ç¤ºç»„ä»¶
- `SystemControls.tsx` - ç³»ç»Ÿæ§åˆ¶é¢æ¿
- `DecisionLog.tsx` - å†³ç­–æ—¥å¿—æ˜¾ç¤º
- `AttentionWeights.tsx` - æ³¨æ„åŠ›æƒé‡å¯è§†åŒ–

##### ğŸ“ utils/ - å·¥å…·å‡½æ•°
- `massaClient.ts` - MassaåŒºå—é“¾äº¤äº’å®¢æˆ·ç«¯

### ğŸ“ src/ - éƒ¨ç½²å’Œæ§åˆ¶è„šæœ¬

#### éƒ¨ç½²è„šæœ¬ï¼š
- `deploy.ts` - åŸºç¡€éƒ¨ç½²è„šæœ¬
- `deploy-step1.ts` - Step1ç³»ç»Ÿä¸“ç”¨éƒ¨ç½²è„šæœ¬
- `deploy-with-existing.ts` - ä½¿ç”¨å·²æœ‰åŸºç¡€è®¾æ–½çš„éƒ¨ç½²è„šæœ¬

#### æ§åˆ¶è„šæœ¬ï¼š
- `control.ts` - ç³»ç»Ÿæ§åˆ¶å‘½ä»¤è¡Œå·¥å…·
  - å¼ºåˆ¶æ‰§è¡Œå‘¨æœŸ
  - ç´§æ€¥åœæ­¢/æ¢å¤
  - æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
  
- `monitor.ts` - ç³»ç»Ÿç›‘æ§è„šæœ¬
  - å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€
  - æ˜¾ç¤ºæ‰§è¡Œæ—¥å¿—
  
- `check-balance.ts` - é’±åŒ…ä½™é¢æŸ¥è¯¢
- `hello.ts` - æµ‹è¯•è„šæœ¬
- `utils.ts` - å…±äº«å·¥å…·å‡½æ•°

#### ğŸ“ data/ - æ•°æ®å­˜å‚¨ç›®å½•
- `buildnet/` - Buildnetæ•°æ®
- `virtual/` - è™šæ‹Ÿå¸‚åœºæ•°æ®
- `shared/` - å…±äº«æ•°æ®

## å¸¸è§å¼€å‘ä»»åŠ¡æŒ‡å—

### 1. å¦‚ä½•æ›´æ”¹UIè®¾è®¡ï¼Ÿ

è¦ä¿®æ”¹ç”¨æˆ·ç•Œé¢ï¼Œéœ€è¦ç¼–è¾‘ä»¥ä¸‹æ–‡ä»¶ï¼š

#### Reactç»„ä»¶æ ·å¼ï¼š
- `frontend/src/index.css` - å…¨å±€æ ·å¼
- `frontend/src/App.tsx` - ä¸»å¸ƒå±€å’Œæ ·å¼
- `frontend/src/components/*.tsx` - å„ä¸ªç»„ä»¶çš„æ ·å¼

#### ä¿®æ”¹æ­¥éª¤ï¼š
1. ç¼–è¾‘ç›¸åº”çš„ç»„ä»¶æ–‡ä»¶
2. è¿è¡Œ `cd frontend && npm run dev` æŸ¥çœ‹æ•ˆæœ
3. ä½¿ç”¨ `npm run build` æ„å»ºç”Ÿäº§ç‰ˆæœ¬

### 2. å¦‚ä½•å¢åŠ Massaå®˜æ–¹é’±åŒ…é“¾æ¥ï¼Ÿ

#### æ–¹æ³•ä¸€ï¼šåœ¨Reactå‰ç«¯æ·»åŠ 
ç¼–è¾‘ `frontend/src/components/SystemControls.tsx`ï¼š

```typescript
// åœ¨ç»„ä»¶ä¸­æ·»åŠ é’±åŒ…è¿æ¥æŒ‰é’®
const connectWallet = async () => {
  // ä½¿ç”¨Massa Web3åº“è¿æ¥é’±åŒ…
  const accounts = await client.wallet.getAccounts();
  // å¤„ç†è¿æ¥é€»è¾‘
};

// åœ¨renderä¸­æ·»åŠ æŒ‰é’®
<button onClick={connectWallet}>
  è¿æ¥Massaé’±åŒ…
</button>
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨massa-web3åº“
åœ¨ `frontend/src/utils/massaClient.ts` ä¸­æ·»åŠ é’±åŒ…è¿æ¥åŠŸèƒ½ï¼š

```typescript
export async function connectMassaWallet() {
  if (window.massa) {
    const accounts = await window.massa.request({ method: 'eth_requestAccounts' });
    return accounts[0];
  }
  throw new Error('Massa wallet not found');
}
```

### 3. ASCï¼ˆè‡ªä¸»æ™ºèƒ½åˆçº¦ï¼‰å®ç°åœ¨å“ªé‡Œï¼Ÿ

ASCçš„æ ¸å¿ƒå®ç°ä½äºï¼š

#### ä¸»è¦æ–‡ä»¶ï¼š
- `assembly/contracts/autonomous/AutonomousScheduler.ts` - **ASCè°ƒåº¦å™¨æ ¸å¿ƒå®ç°**
  - `initializeAutonomousExecution()` - åˆå§‹åŒ–ASC
  - `autonomousExecute()` - è‡ªä¸»æ‰§è¡Œå…¥å£
  - `scheduleNextExecution()` - è°ƒåº¦ä¸‹æ¬¡æ‰§è¡Œ
  - `emergencyStop()` - ç´§æ€¥åœæ­¢
  - `resumeExecution()` - æ¢å¤æ‰§è¡Œ

#### åœ¨ä¸»åˆçº¦ä¸­çš„é›†æˆï¼š
- `assembly/contracts/main.ts` - æŸ¥çœ‹ç¬¬73-107è¡Œ
  - å¯¼å‡ºASCç›¸å…³å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  - åŒ…æ‹¬åˆå§‹åŒ–ã€æ‰§è¡Œã€åœæ­¢ã€æ¢å¤ç­‰åŠŸèƒ½

#### ASCæ‰§è¡Œæµç¨‹ï¼š
1. é€šè¿‡ `initializeASC` åˆå§‹åŒ–
2. ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ `autonomousExecute`
3. æ‰§è¡Œå®Œæˆåè‡ªåŠ¨è°ƒåº¦ä¸‹æ¬¡æ‰§è¡Œ
4. å¯é€šè¿‡ `emergencyStopASC` ç´§æ€¥åœæ­¢

### 4. å¦‚ä½•æ”¯æŒå¤šç§äº¤æ˜“ç­–ç•¥åˆ‡æ¢ï¼Ÿ

è¦å®ç°å¤šç­–ç•¥åˆ‡æ¢ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†ï¼š

#### 1. å®šä¹‰ç­–ç•¥æ¥å£
åœ¨ `assembly/contracts/types.ts` ä¸­æ·»åŠ ï¼š

```typescript
export enum TradingStrategy {
  CONSERVATIVE = 0,  // ä¿å®ˆç­–ç•¥
  MODERATE = 1,      // ç¨³å¥ç­–ç•¥
  AGGRESSIVE = 2     // æ¿€è¿›ç­–ç•¥
}

export interface ITrading Strategy {
  execute(marketState: MarketState): TradingSignal;
  getRiskParams(): RiskParameters;
}
```

#### 2. ä¿®æ”¹å¸‚åœºæ£€æµ‹å™¨
ç¼–è¾‘ `assembly/contracts/algorithms/PracticalMarketDetector.ts`ï¼š
- æ·»åŠ ç­–ç•¥é€‰æ‹©é€»è¾‘
- æ ¹æ®ä¸åŒç­–ç•¥è°ƒæ•´æ£€æµ‹å‚æ•°
- å®ç°ç­–ç•¥ç‰¹å®šçš„ä¿¡å·ç”Ÿæˆ

#### 3. æ›´æ–°äº¤æ˜“æ‰§è¡Œå™¨
ç¼–è¾‘ `assembly/contracts/trading/TradingExecutor.ts`ï¼š
- æ·»åŠ ç­–ç•¥å‚æ•°é…ç½®
- å®ç°ä¸åŒç­–ç•¥çš„é£é™©ç®¡ç†
- è°ƒæ•´ä»“ä½è®¡ç®—é€»è¾‘

#### 4. åœ¨ä¸»æ§åˆ¶å™¨ä¸­é›†æˆ
ç¼–è¾‘ `assembly/contracts/core/SimpleEnhancedController.ts`ï¼š
- æ·»åŠ ç­–ç•¥åˆ‡æ¢å‡½æ•°
- å­˜å‚¨å½“å‰ç­–ç•¥è®¾ç½®
- åœ¨æ‰§è¡Œå¾ªç¯ä¸­åº”ç”¨é€‰å®šç­–ç•¥

#### ç¤ºä¾‹ä»£ç ç»“æ„ï¼š
```typescript
// åœ¨SimpleEnhancedController.tsä¸­
export function setTradingStrategy(strategyType: TradingStrategy): void {
  Storage.set('trading_strategy', strategyType.toString());
  logEvent(LogLevel.INFO, 'Controller', `Strategy switched to ${strategyType}`);
}

export function autonomousCycle(): void {
  const strategy = Storage.get('trading_strategy');
  // æ ¹æ®ç­–ç•¥æ‰§è¡Œä¸åŒé€»è¾‘
}
```

## å¼€å‘å·¥ä½œæµç¨‹

### 1. æœ¬åœ°å¼€å‘
```bash
# å®‰è£…ä¾èµ–
npm install
cd frontend && npm install

# ç¼–è¯‘åˆçº¦
npm run build

# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd frontend && npm run dev
```

### 2. éƒ¨ç½²æµç¨‹
```bash
# éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
npm run deploy-step1

# åˆå§‹åŒ–ASC
npm run init-asc

# ç›‘æ§ç³»ç»ŸçŠ¶æ€
npm run monitor
```

### 3. ç³»ç»Ÿæ§åˆ¶
```bash
# æŸ¥çœ‹çŠ¶æ€
npm run status

# å¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡å¾ªç¯
npm run force-cycle

# ç´§æ€¥åœæ­¢
npm run emergency-stop

# æ¢å¤æ‰§è¡Œ
npm run resume
```

## é‡è¦æç¤º

1. **ç§é’¥å®‰å…¨**ï¼šæ°¸è¿œä¸è¦å°†wallet_*.yamlæ–‡ä»¶æäº¤åˆ°Git
2. **Gasä¼˜åŒ–**ï¼šä¿®æ”¹åˆçº¦æ—¶æ³¨æ„Gasæ¶ˆè€—ï¼Œç‰¹åˆ«æ˜¯ASCæ‰§è¡Œå‡½æ•°
3. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰å…³é”®æ“ä½œéƒ½åº”åŒ…å«é”™è¯¯å¤„ç†
4. **æ—¥å¿—è®°å½•**ï¼šä½¿ç”¨logEventå‡½æ•°è®°å½•é‡è¦æ“ä½œ

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- è‹±æ–‡README.mdè·å–æ›´å¤šæŠ€æœ¯ç»†èŠ‚
- Massaå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.massa.net
- AssemblyScriptæ–‡æ¡£ï¼šhttps://www.assemblyscript.org